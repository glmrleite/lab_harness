<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>{{ app_name }} • {{ app_env }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card shadow-sm">
            <div class="card-body p-4">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h1 class="h3 mb-1">{{ app_name }}</h1>
                  <div class="text-muted">Ambiente: <strong>{{ app_env }}</strong></div>
                  <div class="text-muted">Versão: <strong>{{ app_version }}</strong></div>
                  <div class="text-muted">Commit: <code>{{ git_sha }}</code></div>
                  <div class="text-muted">Uptime: <strong>{{ uptime }}s</strong></div>
                </div>
                <span class="badge rounded-pill text-bg-success">Running</span>
              </div>

              <hr class="my-4"/>

              <p class="mb-2">Endpoints:</p>
              <ul class="mb-4">
                <li><code>/api/info</code></li>
                <li><code>/api/echo</code> (POST JSON)</li>
                <li><code>/api/random-quote</code> {% if not fun_enabled %}<span class="badge text-bg-secondary">disabled</span>{% endif %}</li>
                <li><code>/healthz</code> e <code>/readyz</code></li>
                <li><code>/metrics</code></li>
              </ul>

              <div class="d-flex gap-2">
                <button id="btnInfo" class="btn btn-primary">Carregar /api/info</button>
                <button id="btnQuote" class="btn btn-outline-primary">Random quote</button>
              </div>

              <pre id="out" class="bg-dark text-light p-3 mt-3 rounded" style="min-height: 140px;"></pre>
            </div>
          </div>

          <div class="text-center text-muted mt-3">
            Dica: use variáveis de ambiente <code>APP_ENV</code>, <code>APP_VERSION</code>, <code>GIT_SHA</code>.
          </div>
        </div>
      </div>
    </div>

    <script>
      const out = document.getElementById("out");
      const pretty = (obj) => JSON.stringify(obj, null, 2);

      document.getElementById("btnInfo").onclick = async () => {
        out.textContent = "loading...";
        const r = await fetch("/api/info");
        out.textContent = pretty(await r.json());
      };

      document.getElementById("btnQuote").onclick = async () => {
        out.textContent = "loading...";
        const r = await fetch("/api/random-quote");
        out.textContent = pretty(await r.json());
      };
    </script>
  </body>
</html>
